  {% extends "AeagSqeBundle::layout.html.twig" %}

{% block breadcrumb %}
    <li>
        <a href="{{ path('aeag_homepage') }}">Accueil</a> 
    </li>
    <li>
           <a href="{{ path('AeagSqeBundle_saisieDonnees_index') }}">Saisie des données</a> 
    </li>
    <li>
           <a href="{{ path('AeagSqeBundle_saisieDonnees_index') }}">Lots</a> 
    </li>
    <li>
           <a href="{{path('AeagSqeBundle_saisieDonnees_lot_periodes',{ 'lotanId': lotan.id })}}">Périodes</a> 
    </li>
     <li>
           <a href="{{path('AeagSqeBundle_saisieDonnees_lot_periode_stations',{ 'periodeAnId': periodeAn.id })}}">Stations</a> 
    </li>
     <li class="active">
          Saisie des données terrain
    </li>
{% endblock breadcrumb %} 

{%block panel_heading %}
        <div class="row">
                <div class="col-md-offset-3 col-md-7">
                     <h3 class="page-title ">
                         <table>
                             <tr><td>Station {{ station.code }} {{ station.libelle }}</td></tr>
                             <tr><td>prévu entre le  {{ periodeAn.periode.dateDeb | date("d/m/Y") }}&nbsp;&nbsp;et&nbsp;&nbsp; {{periodeAn.periode.dateFin | date("d/m/Y") }}</td></tr>
                             <tr><td nowrap>pour le lot :  {{ lotan.lot.nomLot }} - {{ lotan.anneeProg }}  - version :  {{ lotan.version }}</td></tr>
                         </table>
                    </h3>
                </div>
                <div class="col-md-1  pull-left">
                        <a id="expandAll" href="#" class="btn btn-primary" role="button"><i class="fa fa-expand"></i></a>
                        <a id="collapseAll" href="#" class="btn btn-primary" role="button"><i class="fa fa-compress"></i></a>
                </div>
        </div>
 {%endblock panel_heading %}

{%block content %}
 
    <form class="form" id="idForm" role="form" action="{{ path("AeagSqeBundle_saisieDonnees_lot_periode_station_env_situ_resultat",{"prelevId":  cmdPrelev.id, "periodeAnId":  periodeAn.id, "stationId": station.ouvFoncId}) }}" method="post">
    
    <div class="form-body">  
        
        {% if typeMilieu.codeMilieu == 'LPC' %}
             <div class="form-group form-inline">
                     <label class="col-md-offset-3 col-xs-2 control-label">Date prélèvement</label>
                    <label class="col-xs-2 control-label">Profondeur du lac (m)</label>
                     <label class="col-xs-2 control-label">Ecart</label>
             </div>
            <div class="form-group form-inline">
                    <div class="col-md-offset-3 col-xs-2  input-group">
                            <input type="text" id="datePrel" name="datePrel" required="required" class="form-control text-center" placeholder="Date prélèvement" value="{{ cmdPrelev.datePrelev | date("d/m/Y H:i") }}">
                     </div>
                     <div class="col-xs-2  input-group">
                            <input type="text" id="profMax" name="profMax" required="false" class="form-control number text-right" placeholder="Profondeur du lac" value="{{ cmdPrelev.profMax }}">
                     </div>
                      <div class="col-xs-2  input-group">
                               <select class="form-control number text-right" id="ecart" name="ecart" >   
                                        <option value="0.5"  selected>0.5 m</option> 
                                         <option value="1">1 m</option> 
                               </select>
                     </div>
           </div>
          {% else %}
               <div class="form-group form-inline">
                     <label class=" col-md-offset-3 col-xs-2 control-label">Date prélèvement :</label>
                     <div class="col-xs-2  input-group">
                            <input type="text" id="datePrel" name="datePrel" required="required" class="form-control text-center" placeholder="Date prélèvement" value="{{ cmdPrelev.datePrelev | date("d/m/Y H:i") }}">
                     </div>
             </div>
          {% endif %}
        
        {% for groupe   in  groupes %}
             <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default">
                            {% if is_granted('ROLE_ADMINSQE') or  (user.prestataire.adrCorId == groupe.grparAn.prestaDft.adrCorId)  %}
                                    <div class="panel-heading" role="tab" id="heading{{groupe.grparAn.id}}">
                                             <h4 class="panel-title h4-default">
                                                     <div class="row">
                                                        <div class="col-md-8">
                                                            <a id="idCollapse{{ groupe.grparAn.id}}" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{ groupe.grparAn.id}}" aria-expanded="true" aria-controls="collapse{{ groupe.grparAn.id}}">
                                                                <i id="idCollapseI{{ groupe.grparAn.id}}" class="btn btn-default fa fa-compress text-center"></i>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ groupe.grparAn.grparRef.codeGrp }} {{ groupe.grparAn.grparRef.libelleGrp }}
                                                          </a>
                                                       </div>
                                                        <div class="col-md-4 pull-right text-info">
                                                              <ul class="list-inline">
                                                                  <li><span  class="label label-success">{{ groupe.correct}}</li>
                                                                  <li><span  class="label label-warning">{{ groupe.warning}}</li>
                                                                  <li><span  class="label label-danger">{{ groupe.erreur}}</li>
                                                                 <li><span  class="label label-primary"><span id="paramSaisis{{ groupe.grparAn.id}}">0</span>/{{ groupe.paramAns | length}}</span></li>
                                                               </ul>  
                                                         </div>
                                                   </div>            
                                              </h4>
                                    </div>
                           {% else %}
                                        <div class="panel-heading" role="tab" id="heading{{groupe.grparAn.id}}">
                                             <h4 class="panel-title h4-default">
                                                     <div class="row">
                                                        <div class="col-md-8">
                                                            <a id="idCollapse{{ groupe.grparAn.id}}" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{ groupe.grparAn.id}}" aria-expanded="true" aria-controls="collapse{{ groupe.grparAn.id}}">
                                                                <i id="idCollapseI{{ groupe.grparAn.id}}" class="btn btn-default fa fa-compress text-center"></i>
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ groupe.grparAn.grparRef.codeGrp }} {{ groupe.grparAn.grparRef.libelleGrp }}
                                                                &nbsp;renseigné par le prestataire {{ groupe.grparAn.prestaDft.nomCorres }}
                                                          </a>
                                                       </div>
                                                        <div class="col-md-3 pull-right text-info">
                                                              <ul class="list-inline">
                                                                  <li><span  class="label label-success">{{ groupe.correct}}</li>
                                                                  <li><span  class="label label-warning">{{ groupe.warning}}</li>
                                                                  <li><span  class="label label-danger">{{ groupe.erreur}}</li>
                                                                 <li><span  class="label label-primary"><span id="paramSaisis{{ groupe.grparAn.id}}">0</span>/{{ groupe.paramAns | length}}</span></li>
                                                               </ul>  
                                                         </div>
                                                   </div>            
                                              </h4>
                                    </div>
                            {% endif %}
                             <div id="collapse{{ groupe.grparAn.id}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading{{ groupe.grparAn.id}}">
                                <div class="panel-body">
                                       <table class="table table-bordered " id="idTable{{ groupe.grparAn.id}}">
                                                                       <thead>
                                                                                <tr>
                                                                                  <th>Code</th> 
                                                                                  <th>Libelle</th> 
                                                                                  <th>valeur</th> 
                                                                                  <th>Unité</th> 
                                                                                  <th>Remarque</th> 
                                                                                  <th>Fraction</th> 
                                                                                </tr>
                                                                          </thead>
                                                                       <tbody>
                                                                                   {% for paramAn in groupe.paramAns %}
                                                                                               {% if  paramAn.paramAn %}
                                                                                                    {% if is_granted('ROLE_ADMINSQE') or  (user.prestataire.adrCorId == paramAn.paramAn.prestataire.adrCorId)  %}
                                                                                                         {% if groupe.grparAn.grparRef.typeGrp == 'ENV'  %}
                                                                                                             {% if paramAn.pgCmdMesureEnv %}
                                                                                                                   {% if paramAn.pgCmdMesureEnv.codeStatut == '0' %}
                                                                                                                        <tr class="success">
                                                                                                                   {% elseif paramAn.pgCmdMesureEnv.codeStatut == '1' %}
                                                                                                                        <tr class="warning" data-toggle="tooltip" data-placement="bottom" title="{{ paramAn.pgCmdMesureEnv.libelleStatut}}">
                                                                                                                   {% else %}
                                                                                                                        <tr class="danger" data-toggle="tooltip" data-placement="bottom" title="{{ paramAn.pgCmdMesureEnv.libelleStatut}}">
                                                                                                                   {% endif %}
                                                                                                             {% else %}
                                                                                                                <tr>
                                                                                                            {% endif %}
                                                                                                            <td nowrap>{{ paramAn.paramAn.codeParametre.codeParametre }}</td>
                                                                                                            <td align="left">{{ paramAn.paramAn.codeParametre.nomParametre }}</td>
                                                                                                            <td align="right">
                                                                                                                  <div class="form-group">
                                                                                                                       <div class="input-group text-right">
                                                                                                                           {% if paramAn.valeurs  %}
                                                                                                                                  <select class="form-control" id="idValeur{{ paramAn.paramAn.id}}" name="valeur{{ paramAn.paramAn.id}}"   >    
                                                                                                                                       <option value=""></option> 
                                                                                                                                      {% for valeur in paramAn.valeurs %}
                                                                                                                                              {% if paramAn.pgCmdMesureEnv %}
                                                                                                                                                      {% if paramAn.pgCmdMesureEnv.resultat == valeur.valeur %}
                                                                                                                                                               <option value="{{valeur.valeur  | replace({".00" : ""})}}" selected>{{valeur.libelle }}</option> 
                                                                                                                                                      {% else %}
                                                                                                                                                               <option value="{{valeur.valeur  | replace({".00" : ""}) }}">{{ valeur.libelle }}</option> 
                                                                                                                                                      {% endif %}
                                                                                                                                                {% else %}
                                                                                                                                                       <option value="{{valeur.valeur  | replace({".00" : ""})}}">{{ valeur.libelle}}</option> 
                                                                                                                                               {% endif %}
                                                                                                                                      {% endfor %}
                                                                                                                                    </select>
                                                                                                                             {% else %}
                                                                                                                                 {% if paramAn.pgCmdMesureEnv %}
                                                                                                                                       <input id="idValeur{{ paramAn.paramAn.id}}"  class="form-control number text-right" placeholder="valeur" name ="valeur{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdMesureEnv.resultat | replace({".0000000000" : ""})}}">
                                                                                                                                    {% else %}
                                                                                                                                         <input id="idValeur{{ paramAn.paramAn.id}}" class="form-control number text-right" placeholder="valeur" name ="valeur{{ paramAn.paramAn.id}}" value="">
                                                                                                                                 {% endif %}
                                                                                                                             {% endif %}
                                                                                                                        </div>
                                                                                                                    </div> 
                                                                                                               </td>
                                                                                                                <td align="left">
                                                                                                                  <div class="form-group">
                                                                                                                       <div  class="input-group text-left">
                                                                                                                           {% if paramAn.unites  %}
                                                                                                                                {% if paramAn.unites | length > 1 %}
                                                                                                                                          <select class="form-control" id="idUniteCode{{ paramAn.paramAn.id}}" name="uniteCode{{ paramAn.paramAn.id}}"   >    
                                                                                                                                               {% for unite in paramAn.unites %}
                                                                                                                                                        <option value="{{unite.codeUnite.codeUnite}}">{{ unite.codeUnite.nomUnite}}</option> 
                                                                                                                                             {% endfor %}
                                                                                                                                            </select>
                                                                                                                                 {% else %}
                                                                                                                                    <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{paramAn.unites.0.codeUnite.codeUnite}}" readonly="readonly">
                                                                                                                                     <input id="idUnite{{ paramAn.paramAn.id}}" type="text" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{paramAn.unites.0.codeUnite.nomUnite}}" readonly="readonly">
                                                                                                                                    {% endif %}
                                                                                                                            {% else %}
                                                                                                                                 {% if paramAn.pgCmdMesureEnv %}
                                                                                                                                       <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdMesureEnv.codeUnite.codeUnite }}">
                                                                                                                                        <input id="idUnite{{ paramAn.paramAn.id}}" type="text" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdMesureEnv.codeUnite.nomUnite }}" readonly="readonly">
                                                                                                                                   {% else %}
                                                                                                                                        <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{ paramAn.unite.codeUnite }}">
                                                                                                                                         <input id="idUnite{{ paramAn.paramAn.id}}" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{ paramAn.unite.nomUnite }}" readonly="readonly">
                                                                                                                                 {% endif %}
                                                                                                                            {% endif %}
                                                                                                                        </div>
                                                                                                                    </div> 
                                                                                                                </td>
                                                                                                                <td align="right">
                                                                                                                  <div class="form-group">
                                                                                                                       <div class="input-group text-left">
                                                                                                                                 <select class="form-control" id="idRemarque{{ paramAn.paramAn.id}}" name="remarque{{ paramAn.paramAn.id}}"   >    
                                                                                                                                       <option value="1"  selected>Donnée renseignée</option> 
                                                                                                                                       <option value="0">Donnée absente</option> 
                                                                                                                                 </select>
                                                                                                                          </div>
                                                                                                                    </div> 
                                                                                                                </td>
                                                                                                             <td align="left">
                                                                                                                {% if paramAn.fraction %}
                                                                                                                    <span class="text-left">{{ paramAn.fraction.nomFraction }}</span>
                                                                                                                {% endif %}
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                          {% else %}
                                                                                                              {% if paramAn.pgCmdAnalyse %}
                                                                                                                   {% if paramAn.pgCmdAnalyse.codeStatut == '0' %}
                                                                                                                        <tr class="success">
                                                                                                                   {% elseif paramAn.pgCmdAnalyse.codeStatut == '1' %}
                                                                                                                        <tr class="warning" data-toggle="tooltip" data-placement="bottom" title="{{ paramAn.pgCmdAnalyse.libelleStatut}}">
                                                                                                                   {% else %}
                                                                                                                        <tr class="danger" data-toggle="tooltip" data-placement="bottom" title="{{ paramAn.pgCmdAnalyse.libelleStatut}}" >
                                                                                                                   {% endif %}
                                                                                                             {% else %}
                                                                                                                <tr>
                                                                                                            {% endif %}
                                                                                                                 <td nowrap>{{ paramAn.paramAn.codeParametre.codeParametre }}</td>
                                                                                                                  <td align="left">{{ paramAn.paramAn.codeParametre.nomParametre }}</td>
                                                                                                                  <td align="right">
                                                                                                                        <div class="form-group">
                                                                                                                             <div class="input-group text-right">
                                                                                                                                 {% if paramAn.valeurs  %}
                                                                                                                                        <select class="form-control" id="idValeur{{ paramAn.paramAn.id}}" name="valeur{{ paramAn.paramAn.id}}"   >    
                                                                                                                                             <option value=""></option> 
                                                                                                                                            {% for valeur in paramAn.valeurs %}
                                                                                                                                                    {% if paramAn.pgCmdAnalyse %}
                                                                                                                                                            {% if paramAn.pgCmdAnalyse.resultat == valeur.valeur %}
                                                                                                                                                                     <option value="{{valeur.valeur  | replace({".00" : ""}) }}" selected>{{valeur.libelle }}</option> 
                                                                                                                                                            {% else %}
                                                                                                                                                                     <option value="{{valeur.valeur  | replace({".00" : ""}) }}">{{ valeur.libelle }}</option> 
                                                                                                                                                            {% endif %}
                                                                                                                                                      {% else %}
                                                                                                                                                             <option value="{{valeur.valeur  | replace({".00" : ""}) }}">{{ valeur.libelle}}</option> 
                                                                                                                                                     {% endif %}
                                                                                                                                            {% endfor %}
                                                                                                                                          </select>
                                                                                                                                   {% else %}
                                                                                                                                       {% if paramAn.pgCmdAnalyse %}
                                                                                                                                             <input id="idValeur{{ paramAn.paramAn.id}}" class="form-control number text-right" placeholder="valeur" name ="valeur{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdAnalyse.resultat | replace({".0000000000" : ""}) }}">
                                                                                                                                         {% else %}
                                                                                                                                               <input id="idValeur{{ paramAn.paramAn.id}}" class="form-control number text-right" placeholder="valeur" name ="valeur{{ paramAn.paramAn.id}}" value="">
                                                                                                                                       {% endif %}
                                                                                                                                   {% endif %}
                                                                                                                              </div>
                                                                                                                          </div> 
                                                                                                                   </td>
                                                                                                                   <td align="left">
                                                                                                                        <div class="form-group">
                                                                                                                             <div  class="input-group text-left">
                                                                                                                                 {% if paramAn.unites  %}
                                                                                                                                      {% if paramAn.unites | length > 1 %}
                                                                                                                                                <select class="form-control" id="idUniteCode{{ paramAn.paramAn.id}}" name="uniteCode{{ paramAn.paramAn.id}}"   >    
                                                                                                                                                    {% for unite in paramAn.unites %}
                                                                                                                                                                      <option value="{{unite.codeUnite.codeUnite}}">{{ unite.codeUnite.nomUnite}}</option> 
                                                                                                                                                    {% endfor %}
                                                                                                                                                  </select>
                                                                                                                                       {% else %}
                                                                                                                                            <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{paramAn.unites.0.codeUnite.codeUnite}}" readonly="readonly">
                                                                                                                                           <input id="idUnite{{ paramAn.paramAn.id}}" type="text" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{paramAn.unites.0.codeUnite.nomUnite}}" readonly="readonly">
                                                                                                                                       {% endif %}
                                                                                                                                  {% else %}
                                                                                                                                       {% if paramAn.pgCmdAnalyse %}
                                                                                                                                             <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdAnalyse.codeUnite.codeUnite }}">
                                                                                                                                             <input id="idUnite{{ paramAn.paramAn.id}}" type="text" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{ paramAn.pgCmdAnalyse.codeUnite.nomUnite }}">
                                                                                                                                         {% else %}
                                                                                                                                               <input id="idUniteCode{{ paramAn.paramAn.id}}" type="hidden" class="form-control" placeholder="unite" name ="uniteCode{{ paramAn.paramAn.id}}" value="{{ paramAn.unite.codeUnite }}">
                                                                                                                                               <input id="idUnite{{ paramAn.paramAn.id}}" class="form-control" placeholder="unite" name ="unite{{ paramAn.paramAn.id}}" value="{{ paramAn.unite.nomUnite }}" readonly="readonly">
                                                                                                                                       {% endif %}
                                                                                                                                  {% endif %}
                                                                                                                              </div>
                                                                                                                          </div> 
                                                                                                                   </td>
                                                                                                                  <td align="right">
                                                                                                                  <div class="form-group">
                                                                                                                       <div class="input-group text-left">
                                                                                                                                 <select class="form-control" id="idRemarque{{ paramAn.paramAn.id}}" name="remarque{{ paramAn.paramAn.id}}"   >    
                                                                                                                                       <option value="1"  selected>Donnée renseignée</option> 
                                                                                                                                       <option value="0">Donnée absente</option> 
                                                                                                                                 </select>
                                                                                                                          </div>
                                                                                                                    </div> 
                                                                                                                 </td>
                                                                                                                  <td align="left">
                                                                                                                      {% if paramAn.fraction %}
                                                                                                                          <span class="text-left">{{ paramAn.fraction.nomFraction }}</span>
                                                                                                                      {% endif %}
                                                                                                                  </td>
                                                                                                              </tr>
                                                                                                          {% endif %}
                                                                                                    {% else %}
                                                                                                          {% if groupe.grparAn.grparRef.typeGrp == 'ENV'  %}
                                                                                                          <tr>
                                                                                                            <td nowrap>{{ paramAn.paramAn.codeParametre.codeParametre }}</td>
                                                                                                            <td align="left">{{ paramAn.paramAn.codeParametre.nomParametre }}</td>
                                                                                                            <td align="right">
                                                                                                                   {% if paramAn.pgCmdMesureEnv %}
                                                                                                                       <span class="text-right">{{ paramAn.pgCmdMesureEnv.resultat | replace({".0000000000" : ""}) }}</span>
                                                                                                                    {% endif %}
                                                                                                             </td>
                                                                                                              <td align="left">
                                                                                                                      {% if paramAn.pgCmdMesureEnv %}
                                                                                                                          <span class="text-left">{{ paramAn.pgCmdMesureEnv.codeUnite.nomUnite }}</span>
                                                                                                                      {% endif %}
                                                                                                             </td>
                                                                                                              <td align="left"></td>
                                                                                                             <td align="left">
                                                                                                                {% if paramAn.fraction %}
                                                                                                                    <span class="text-left">{{ paramAn.fraction.nomFraction }}</span>
                                                                                                                {% endif %}
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                          {% else %}
                                                                                                              <tr>
                                                                                                                  <td nowrap>{{ paramAn.paramAn.codeParametre.codeParametre }}</td>
                                                                                                                  <td align="left">{{ paramAn.paramAn.codeParametre.nomParametre }}</td>
                                                                                                                  <td align="right">
                                                                                                                      {% if paramAn.pgCmdAnalyse %}
                                                                                                                          <span class="text-right">{{ paramAn.pgCmdAnalyse.resultat | replace({".0000000000" : ""})  }}</span>
                                                                                                                      {% endif %}
                                                                                                                  </td>
                                                                                                                  <td align="left">
                                                                                                                         {% if paramAn.pgCmdAnalyse %}
                                                                                                                             <span class="text-left">{{ paramAn.pgCmdAnalyse.codeUnite.nomUnite }}</span>
                                                                                                                   </td>
                                                                                                                   <td align="left"></td>
                                                                                                                  <td align="left">
                                                                                                                      {% if paramAn.fraction %}
                                                                                                                          <span class="text-left">{{ paramAn.fraction.nomFraction }}</span>
                                                                                                                      {% endif %}
                                                                                                                  </td>
                                                                                                              </tr>
                                                                                                          {% endif %}
                                                                                                   {% endif %}
                                                                                                   {% endif %}
                                                                                                {% endif %}
                                                                                      {% endfor %}
                                                                        </tbody>
                                                             </table>
                                         <div class="row">
                                              <div class="col-md-12 pull-right text-info">
                                                <ul class="list-inline">
                                                    <li><span class="label label-success">Correct</span></li>
                                                    <li><span class="label label-warning">Avertissement</span></li>
                                                     <li><span class="label label-danger">Erreur</span></li>
                                                </ul>  
                                              </div>
                                            </div>      
                                  </div>
                        </div>
             </div>
        {% endfor %}
        
          <div class="row">
           <div class="col-md-12 pull-right text-info">
             <ul class="list-inline">
               <li><span class="label label-success">Correcte</span></li>
               <li><span class="label label-warning">Avertissement</span></li>
               <li><span class="label label-danger">Erreur</span></li>
             </ul>  
           </div>
         </div>            
    
    {% if maj == 'M' %}
        <div class="col-md-offset-5 col-md-8">
               <button id="idEnregistrer" type="submit" class="btn btn-success"> 
                    <i class="fa fa-check"> Enregister</i>
                </button>
      {% else %}
           <div class="col-md-offset-5 col-md-8">
     {% endif %}
           <a class="btn btn-danger" href="{{path('AeagSqeBundle_saisieDonnees_lot_periode_stations',{'stationId': station.ouvFoncId, 'periodeAnId': periodeAn.id, 'cmdDemandeId': demande.id })}}">
                <i class="fa fa-undo"> Annuler</i>
            </a>
          </div>
       
          <div id="idCache"></div>
          
       </div>
     </form>

    {%endblock content %}    


{% block scripts %}
    
            $('#datePrel').datetimepicker(
             {language:  'fr',
              format: 'dd/mm/yyyy hh:ii'
              }
            );
    
          {% for groupe   in  groupes %}
              
             
                   $('#idCollapse{{groupe.grparAn.id}}').on('click',function(){
                             if ($('#idCollapseI{{groupe.grparAn.id}}').hasClass("fa-compress")){
                                  $('#idCollapseI{{groupe.grparAn.id}}').removeClass("fa-compress").addClass("fa-expand");
                                   $('#collapse{{groupe.grparAn.id}}').collapse('hide');
                              }else{
                                 $('#idCollapseI{{groupe.grparAn.id}}').removeClass("fa-expand").addClass("fa-compress");
                                  $('#collapse{{groupe.grparAn.id}}').collapse('show');
                              }
                   });

              
                    var table{{groupe.grparAn.id }} = $('#idTable{{ groupe.grparAn.id }}').DataTable(
                       {"stateSave": true,
                         "order": [[ 0, "desc" ]],
                        "language": {
                                "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json"
                               },
                        "aLengthMenu": [
                                                   [10, 25, 50, 100, -1],
                                                   [10, 25, 50, 100, "Tous"]
                                               ],
                         "iDisplayLength": -1
                        }
                        );
                    
                   var nbParamSaisis{{groupe.grparAn.id }} = parseInt($('#paramSaisis{{ groupe.grparAn.id}}').html());
                
                   {% if groupe.grparAn.grparRef.typeGrp == 'ENV'  %}
                            {% for paramAn in groupe.paramAns %}
                                    {% if paramAn.pgCmdMesureEnv %}
                                           nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} + 1;
                                           $('#paramSaisis{{ groupe.grparAn.id}}').empty().html(nbParamSaisis{{groupe.grparAn.id }});
                                            if ($("#idValeur{{ paramAn.paramAn.id}}").val() == "" ){
                                                $('#idRemarque{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                var remarque =  "0";
                                                $("#idRemarque{{ paramAn.paramAn.id}} option[value='" + remarque + "']").attr('selected','selected');
                                                $("#idRemarque{{ paramAn.paramAn.id}}").val(remarque);
                                             };
                                           {% for valeur in paramAn.valeurs %}
                                                    {% if paramAn.pgCmdMesureEnv.resultat | replace({".0000000000" : ""})   == valeur.valeur  | replace({".00" : ""}) %}
                                                            $('#idValeur{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                            var valeur =   {{ valeur.valeur |  replace({".00" : ""})}}
                                                            $("#idValeur{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                            $("#idValeur{{ paramAn.paramAn.id}}").val(valeur);
                                                    {% endif %}
                                           {% endfor %}
                                   {% endif %}
                                    $(document).on('change','#idValeur{{ paramAn.paramAn.id}}',function(e){
                                            if ($("#idValeur{{ paramAn.paramAn.id}}").val() != "" ){
                                                     $('#idRemarque{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                      var remarque =  "1";
                                                      $("#idRemarque{{ paramAn.paramAn.id}} option[value='" + remarque + "']").attr('selected','selected');
                                                     $("#idRemarque{{ paramAn.paramAn.id}}").val(remarque);
                                             }
                                            if ($("#idValeur{{ paramAn.paramAn.id}}").val() == "" ){
                                                nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} - 1;
                                             }else{
                                                nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} + 1;
                                             };
                                             $('#paramSaisis{{ groupe.grparAn.id}}').empty().html(nbParamSaisis{{groupe.grparAn.id }});
                                       });
                                       
                                       $(document).on('change','#idRemarque{{ paramAn.paramAn.id}}',function(e){
                                            if ($("#idRemarque{{ paramAn.paramAn.id}}").val() == "0" ){
                                                 $("#idValeur{{ paramAn.paramAn.id}}").val(null);
                                            }
                                        });
                                       
                                    {% for unite in paramAn.unites %}
                                            {% if paramAn.pgCmdMesureEnv %}
                                                    {% if paramAn.pgCmdMesureEnv.codeUnite.codeUnite == unite.codeUnite.codeUnite %}
                                                            $('#idUniteCode{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                            var valeur =   '{{ paramAn.pgCmdMesureEnv.codeUnite.codeUnite }}';
                                                              $("#idUniteCode{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                              $("#idUniteCode{{ paramAn.paramAn.id}}").val(valeur);
                                                      {% endif %}
                                            {% elseif paramAn.unite %}
                                                    {% if paramAn.unite.codeUnite == unite.codeUnite.codeUnite %}
                                                             $('#idUniteCode{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                            var valeur =   '{{ paramAn.unite.codeUnite }}';
                                                            $("#idUniteCode{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                            $("#idUniteCode{{ paramAn.paramAn.id}}").val(valeur);
                                                      {% endif %}
                                            {% endif %}
                                    {% endfor %}
                             {% endfor %}
                   {% else %}
                            {% for paramAn in groupe.paramAns %}
                                    {% if paramAn.pgCmdAnalyse %}
                                             nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} + 1;
                                            $('#paramSaisis{{ groupe.grparAn.id}}').empty().html(nbParamSaisis{{groupe.grparAn.id }});
                                             if ($("#idValeur{{ paramAn.paramAn.id}}").val() == "" ){
                                                $('#idRemarque{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                var remarque =  "0";
                                                $("#idRemarque{{ paramAn.paramAn.id}} option[value='" + remarque + "']").attr('selected','selected');
                                                $("#idRemarque{{ paramAn.paramAn.id}}").val(remarque);
                                            };
                                            {% for valeur in paramAn.valeurs %}
                                                         {% if paramAn.pgCmdAnalyse.resultat | replace({".0000000000" : ""})  == valeur.valeur  | replace({".00" : ""}) %}
                                                                $('#idValeur{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                                var valeur =   {{ valeur.valeur |  replace({".00" : ""}) }}
                                                                $("#idValeur{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                                $("#idValeur{{ paramAn.paramAn.id}}").val(valeur);
                                                       {% endif %}
                                              {% endfor %}
                                    {% endif %}
                                    
                                     $(document).on('change','#idValeur{{ paramAn.paramAn.id}}',function(e){
                                            if ($("#idValeur{{ paramAn.paramAn.id}}").val() != "" ){
                                               $('#idRemarque{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                var remarque =  "1";
                                                $("#idRemarque{{ paramAn.paramAn.id}} option[value='" + remarque + "']").attr('selected','selected');
                                               $("#idRemarque{{ paramAn.paramAn.id}}").val(remarque);
                                            }
                                      
                                            if ($("#idValeur{{ paramAn.paramAn.id}}").val() == "" ){
                                                nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} - 1;
                                             }else{
                                                nbParamSaisis{{groupe.grparAn.id }} = nbParamSaisis{{groupe.grparAn.id }} + 1;
                                             };
                                             $('#paramSaisis{{ groupe.grparAn.id}}').empty().html(nbParamSaisis{{groupe.grparAn.id }});
                                       });
                                    
                                      $(document).on('change','#idRemarque{{ paramAn.paramAn.id}}',function(e){
                                            if ($("#idRemarque{{ paramAn.paramAn.id}}").val() == "0" ){
                                                 $("#idValeur{{ paramAn.paramAn.id}}").val(null);
                                            }
                                        });
                                    {% for unite in paramAn.unites %}
                                            {% if paramAn.pgCmdAnalyse %}
                                                    {% if paramAn.pgCmdAnalyse.codeUnite.codeUnite == unite.codeUnite.codeUnite %}
                                                           $('#idUniteCode{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                            var valeur =   '{{ unite.codeUnite.codeUnite }}';
                                                           $("#idUniteCode{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                           $("#idUniteCode{{ paramAn.paramAn.id}}").val(valeur);
                                                      {% endif %}
                                            {% elseif paramAn.unite %}
                                                    {% if paramAn.unite.codeUnite == unite.codeUnite.codeUnite %}
                                                             $('#idUniteCode{{ paramAn.paramAn.id}} option:selected').removeAttr('selected');
                                                            var valeur =   '{{ paramAn.unite.codeUnite }}';
                                                             $("#idUniteCode{{ paramAn.paramAn.id}} option[value='" + valeur + "']").attr('selected','selected');
                                                             $("#idUniteCode{{ paramAn.paramAn.id}}").val(valeur);
                                                       {% endif %}
                                            {% endif %}
                                      {% endfor %}
                             {% endfor %}
                   {% endif %}
                   
                    $('#idCollapseI{{groupe.grparAn.id}}').removeClass("fa-compress").addClass("fa-expand");
                    $('#collapse{{groupe.grparAn.id}}').collapse('hide');
                    $('#expandAll{{groupe.grparAn.id}}').show();
                    $('#collapseAll{{groupe.grparAn.id}}').hide(); 
                   
                   
          {% endfor %}
             
                               
            $('#expandAll').show();
            $('#collapseAll').hide();          

           $('#expandAll').on('click',function(){
                   {% for groupe   in  groupes %}
                          $('#idCollapseI{{groupe.grparAn.id}}').removeClass("fa-expand").addClass("fa-compress");
                           $('#collapse{{groupe.grparAn.id}}').collapse('show');
                           $('#expandAll{{groupe.grparAn.id}}').hide();
                           $('#collapseAll{{groupe.grparAn.id}}').show();          
                     {% endfor %}
                      $('#expandAll').hide();
                      $('#collapseAll').show();
               });

           $('#collapseAll').on('click',function(){
                    {% for groupe   in  groupes %}
                           $('#idCollapseI{{groupe.grparAn.id}}').removeClass("fa-compress").addClass("fa-expand");
                           $('#collapse{{groupe.grparAn.id}}').collapse('hide');
                           $('#expandAll{{groupe.grparAn.id}}').show();
                           $('#collapseAll{{groupe.grparAn.id}}').hide(); 
                     {% endfor %}
                      $('#expandAll').show();
                      $('#collapseAll').hide();
           });
           
           $(document).on('click', '#idEnregistrer',function(e){
                 $('#modalTraitementEncours').modal();
               {#   {% for groupe   in  groupes %}
                          $('#collapse{{groupe.grparAn.id}}').collapse('show');
                           var nbRecords = $('#idTable{{ groupe.grparAn.id}}_length option:selected').val();
                           table{{groupe.grparAn.id }}.page.len( -1 ).draw();
                     {% endfor %}
                     alert('ici');#}
                      $('#idForm').submit();
           });

   
    
{%endblock scripts %}    