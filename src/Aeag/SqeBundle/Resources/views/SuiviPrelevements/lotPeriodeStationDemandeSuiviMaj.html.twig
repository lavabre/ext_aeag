<form class="form-horizontal" id="idForm" role="form" action="{{ path("AeagSqeBundle_suiviPrelevements_lot_periode_station_demande_suivi_maj",{"suiviPrelId":  suiviPrel.id, "periodeAnId": periodeAnId}) }}" class="form-horizontal" method="post" {{ form_enctype(form) }}>

 <div class="form-group">
        <label class="col-xs-3 control-label">Date :</label>
        {%if form_errors(form.datePrel) %}
            <div class="col-xs-8 input-group has-error has-feedback">
        {% else %}
             <div class="col-xs-8 input-group">
         {% endif %}
           {{ form_widget(form.datePrel, { 'attr': {'class': 'form-control ', 'placeholder': 'Date'} }) }}
         </div>
 </div> 
         
<div class="form-group">
        <label class="col-xs-3 control-label">Statut :</label>
        {%if form_errors(form.statutPrel) %}
            <div class="col-xs-8 input-group has-error has-feedback">
        {% else %}
             <div class="col-xs-8 input-group">
         {% endif %}
           {{ form_widget(form.statutPrel, { 'attr': {'class': 'form-control ', 'placeholder': 'Statut'} }) }}
         </div>
 </div> 
         
<div class="form-group">
        <label class="col-xs-3 control-label">Commentaire : </label>
        {%if form_errors(form.commentaire) %}
            <div class="col-xs-8 input-group has-error has-feedback">
        {% else %}
             <div class="col-xs-8 input-group">
         {% endif %}
           {{ form_widget(form.commentaire, { 'attr': {'class': 'form-control ', 'placeholder': 'Commentaire'} }) }}
         </div>
 </div> 
         
         
     <div class="form-group">
         <label class="col-xs-3 control-label">Fichier terrain : </label>
         <div id="idResultat">
                <div id="idSelection" class="col-xs-7">
                       <form method="POST" enctype="multipart/form-data" action="#" id="idFormFichier">
                          <input class="form-control" type="file" name="file" >
                      </form> 
                </div>
                 <div class="col-xs-1">
                     <button type="button" id="idDeposer" class="btn btn-success" >Déposer</button> 
                  </div>
            </div>
         <div id="idProgress" class="col-xs-7 info"><progress></progress></div>
      </div>
         
     <div class="form-group">
        <div class="col-xs-offset-4 col-xs-8">
           <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-undo"></i> Annuler</button>
           <button id="btForm" type="submit" class="btn btn-success"><i class="fa fa-check"></i>Valider</button>
         </div>
     </div>        
         
        <div class="hide">
            {{ form_rest(form) }}
        </div>  
   </form>      
        
        <script type="text/javascript" language="javascript">
            
             jQuery(document).ready(function() {
            
              $('#datePrel').datepicker();
            
                    $(document).on('change','#statutPrel',function(e){
                       e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                       if ($('#statutPrel').val() == 'F'){
                           $('#commentaire').removeAttr('required');
                      }else{
                          $('#commentaire').attr('required', ''); 
                      };
                  });
                  
                 {# $('#idDeposer').click(function (){
                            $('#modalTraitementEncours').modal();
                            $('#idFormFichier').submit();
                           $('#idSelection').hide();
                            $('#idResultat').empty().append('Fichier déposé');
                            $('#modalTraitementEncours').modal('hide');
                });#}
            
               $('#idProgress').hide();
               $('#idDeposer').on('click', function (e) {
                         e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                         $('#modalTraitementEncours').modal('toggle');
                         $('#idPprogress').show();
                        var url = '{{ path("AeagSqeBundle_suiviPrelevements_lot_periode_station_demande_suivi_fichier_deposer",{"suiviPrelId":  "par1", "periodeAnId": "par2"}) }}', // Le nom du fichier indiqué dans le formulaire
                         url = url.replace("par1", {{ suiviPrel.id }});
                         url = url.replace("par2", {{ periodeAnId }});
                         url = url.replace("amp;","");
                         var formulaire = new FormData($('form')[0]);
                         $.ajax({
                                      url: url,
                                      type: 'post',
                                      xhr: function() { // xhr qui traite la barre de progression
                                            myXhr = $.ajaxSettings.xhr();
                                            if(myXhr.upload){ // vérifie si l'upload existe
                                            myXhr.upload.addEventListener('progress',afficherAvancement, false); // Pour ajouter l'évènement progress sur l'upload de fichier
                                            }
                                            return myXhr;
                                       },
                                      //Traitements AJAX
                                      success: function(html) { // Je récupère la réponse du fichier PHP
                                            $('#idResultat').empty().append(html);
                                            $('#modalTraitementEncours').modal('hide');
                                            $('#idProgress').hide();
                                      },
                                       error: function(html) { // Je récupère la réponse du fichier PHP
                                                $('#idResultat').empty().append('erreur lors du dépot');
                                                $('#modalTraitementEncours').modal('hide');
                                                 $('#idProgress').hide();
                                      },
                                      data: formulaire,
                                      cache: false,
                                      contentType: false,
                                      processData: false
                             });
                   });
                   
                     $('#idSupprimer').on('click', function (e) {
                         e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                         $('#modalTraitementEncours').modal('toggle');
                         $('#idPprogress').show();
                        var url = '{{ path("AeagSqeBundle_suiviPrelevements_lot_periode_station_demande_suivi_fichier_supprimer",{"suiviPrelId":  "par1", "periodeAnId": "par2"}) }}', // Le nom du fichier indiqué dans le formulaire
                         url = url.replace("par1", {{ suiviPrel.id }});
                         url = url.replace("par2", {{ periodeAnId }});
                         url = url.replace("amp;","");
                         var formulaire = new FormData($('form')[0]);
                         $.ajax({
                                      url: url,
                                      type: 'post',
                                      xhr: function() { // xhr qui traite la barre de progression
                                            myXhr = $.ajaxSettings.xhr();
                                            if(myXhr.upload){ // vérifie si l'upload existe
                                            myXhr.upload.addEventListener('progress',afficherAvancement, false); // Pour ajouter l'évènement progress sur l'upload de fichier
                                            }
                                            return myXhr;
                                       },
                                      //Traitements AJAX
                                      success: function(html) { // Je récupère la réponse du fichier PHP
                                            $('#idResultat').empty().append(html);
                                            $('#modalTraitementEncours').modal('hide');
                                            $('#idProgress').hide();
                                      },
                                       error: function(html) { // Je récupère la réponse du fichier PHP
                                                $('#idResultat').empty().append('erreur lors du dépot');
                                                $('#modalTraitementEncours').modal('hide');
                                                 $('#idProgress').hide();
                                      },
                                      data: formulaire,
                                      cache: false,
                                      contentType: false,
                                      processData: false
                             });
                   });
                   
                   
                   function afficherAvancement(e){
                        if(e.lengthComputable){
                                  $('progress').attr({value:e.loaded,max:e.total});
                        }
                   }
              
       });
            
        </script>