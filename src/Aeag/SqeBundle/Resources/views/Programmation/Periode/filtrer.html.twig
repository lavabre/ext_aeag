
<table class="table table-bordered table-condensed table-advance" id="idTable_station">
    <thead id="idTheadStations">
        <tr>
            <th width="1%">Actions</th>
            <th width="10%">Stations</th>
            {% for periode in stationAns.0.periodes %}
                <th width="1%" id="idThPeriode_{{ periode.periode.id }}">{{ periode.periode.labelPeriode }}</th>
            {% endfor %}
         </tr>
    </thead>
    <tbody id="idBodyStations">
        {%if stationAns | length%}  
            {% for stationAn in stationAns %}
                <tr id='idStation_{{ stationAn.station.id }}' name='idStation_{{ stationAn.station.id }}' width="10%">
                    <td nowrap>
                        <a id="idDupliquerStation_{{ stationAn.station.id }}" data-toggle="modal" href="#" class="btn btn-primary" href="#" title="dupliquer la programmation sur les autres stations">
                            <i class="fa fa-sitemap"></i> 
                        </a>
                        <a id="init_station_{{ stationAn.station.id }}"  class="btn btn-danger" data-toggle="modal" href="#modalInitialiserStation_{{ stationAn.station.id }}" title="Initialiser les périodes">
                            <i class="fa fa-eraser"></i> 
                        </a>
                    </td>
                     <td nowrap>{{ stationAn.station.station.code}}&nbsp;&nbsp;{{ stationAn.station.station.libelle}}</td>
                       {% for periode in stationAn.periodes %}
                        <td id="idTd_{{ stationAn.station.id }}_{{ periode.periode.id }}">
                            <div id="idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}" class="text-center">
                                    <a id="idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}" class="btn btn-default">
                                        <span id="idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}" class="badge"></span>
                                    </a>
                             </div>
                        </td>
                    {% endfor %}
                 </tr>
            {% endfor %}
        {% endif %}
    </tbody>
</table> 

 <script>
       
     table_station = $('#idTable_station').DataTable(
            {"stateSave": true,
             "order": [[ 1, "asc" ]],
             "oLanguage": {
                    "sSearch": "Filtre",
                    "sFirst": "1ere page",
                    "sLast": "Dernière page",
                    "sNext": "Prochaine page",
                    "sPrevious": "Page précédente",
                    "EmptyTable": "Pas de données",
                    "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                    "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                    "sZeroRecords": "Pas d'enregistrement à afficher",
                    "sInfoEmpty": "Pas d'enregistrement à afficher",
                    "sInfoThousands": " ",
                    "sLengthMenu": 'Afficher <select>' +
                        '<option value="10">10</option>' +
                        '<option value="20">20</option>' +
                        '<option value="30">30</option>' +
                        '<option value="40">40</option>' +
                        '<option value="50">50</option>' +
                        '<option value="-1">Tous</option>' +
                        '</select> enregistrements',
                    "sPaginationType": "full_numbers"
                    }
            }
        ); 
    
     
   {#  traitement sur chaque periode de chaque station   #}
    var nbRecords = $('#idTable_length option:selected').val();
    table_station.page.len( -1 ).draw();
    {% if stationAns |length %}
        {% for stationAn in stationAns %}
            {% for stationAnAutre in stationAns %}
                {% if stationAnAutre.station.id != stationAn.station.id %}
                    {% set nbGroupes = 0 %}
                    {% for periode in stationAnAutre.periodes %}
                        {% if periode.nbGroupe > 0 %}
                            {% set nbGroupes = nbGroupes + periode.nbGroupe %}
                        {% endif %}
                    {% endfor %}
                    {% if  nbGroupes > 0 %}
                        $('#trDupliquerStation_{{ stationAn.station.id }}_{{ stationAnAutre.station.id }}').addClass("danger");
                        $('#nbGroupes_{{ stationAn.station.id }}_{{ stationAnAutre.station.id }}').val({{ nbGroupes }})
                      {% else %}
                         $('#trDupliquerStation_{{ stationAn.station.id }}_{{ stationAnAutre.station.id }}').removeClass("danger");
                         $('#nbGroupes_{{ stationAn.station.id }}_{{ stationAnAutre.station.id }}').val(0)
                      {% endif %}
                {% endif %}
            {% endfor %}
            {% for periode in stationAn.periodes %}
                  {% if periode.nbGroupe > 0 %}
                     {% if periode.autreStatut == 'N' %}
                                $('#idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("warning").removeClass("info").removeClass("primary").addClass("success");
                                $('#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("btn-default").removeClass("btn-warning").removeClass("btn-info").removeClass("btn-primary").addClass('btn-success');
                                $('#idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}').empty().append({{ periode.nbGroupe }} + '/' + {{ grparAns | length }} );
                            {% elseif periode.autreStatut == 'C'%}
                                $('#idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("warning").addClass("info").removeClass("primary").removeClass("success");
                                $('#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("btn-default").removeClass("btn-warning").addClass("btn-info").removeClass("btn-primary").removeClass('btn-success');
                                $('#idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}').empty().append({{ periode.nbGroupe }} + '/' + {{ grparAns | length }} );
                            {% elseif periode.autreStatut == 'I'%}
                                $('#idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("warning").removeClass("info").addClass("primary").removeClass("success");
                                $('#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("btn-default").removeClass("btn-warning").removeClass("btn-info").addClass("btn-primary").removeClass('btn-success');
                                $('#idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}').empty().append({{ periode.nbGroupe }} + '/' + {{ grparAns | length }} );
                            {% endif %}
                {% else %}
                    {% if periode.autreProgrammation == 0 %}
                        $('#idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("success").removeClass("warning");
                        $('#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("btn-success").removeClass("btn-warning").addClass('btn-default');
                        $('#idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}').empty().hide();
                    {% else %}
                        $('#idDiv_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("success").addClass("warning");
                        $('#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}').removeClass("btn-success").removeClass("btn-default").addClass('btn-warning');
                         $('#idNbParametres_{{ stationAn.station.id }}_{{ periode.periode.id }}').empty().append({{ periode.autreProgrammation }} + '/' + {{ grparAns | length }} );
                    {% endif %}
                {% endif %}

                {#   traitement sur un période sélectionner   #}
                $(document).on('click', '#idBt_{{ stationAn.station.id }}_{{ periode.periode.id }}', function(e){
                   var url = '{{ path("AeagSqeBundle_programmation_periode_programmer",{"stationId":  "par1", "periodeId" : "par2" ,"action": "par3","maj":"par4","lotan":"par5"}) }}', // Le nom du fichier indiqué dans le formulaire
                    url = url.replace("par1", {{ stationAn.station.id }});
                    url = url.replace("par2", {{ periode.periode.id }});
                    url = url.replace("amp;","");
                    url = url.replace("par3", '{{ action }}');
                     url = url.replace("amp;","");
                    url = url.replace("par4", '{{ maj }}');
                    url = url.replace("amp;","");
                    url = url.replace("par5", '{{ lotan.id }}');
                    url = url.replace("amp;","");
                    $.ajax({
                        url: url,
                        type: 'get', // La méthode indiquée dans le formulaire (get ou post)
                        success: function(html) { // Je récupère la réponse du fichier PHP
                            $('#idModalProgrammer').modal('show'); 
                            $('#idModalContentProgrammer').empty().append(html);
                           }
                    });
                    
                  });

            {% endfor %}
           
       {% endfor %}
    {% endif %}
    table_station.page.len( 10 ).draw();
  
    
    
</script>