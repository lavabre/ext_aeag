{% extends "AeagSqeBundle::layout.html.twig" %}

{% block breadcrumb %}
             <li>
                   <a href="{{ path('aeag_homepage') }}">Accueil</a> 
                  </li>
                  <li>
                    <a href="{{ path('Aeag_sqe_programmation_lots', {'action': action}) }}">Critères</a> 
                  </li>
                  <li>
                        <a href="{{ path('AeagSqeBundle_programmation_lot_retour', {'action': action}) }}">Lots</a> 
                  </li>
                  <li>
                       <a  id="idMenuStation" href="#">Stations</a> 
                  </li>
                 <li class="active">
                         Groupes de parametres
                  </li>
      {% if action != 'P' or (action == 'P' and  maj != 'C') %}
                  <li>
                      <a id="idMenuPeriode" href="#">Périodes</a> 
                  </li>
                  <li>
                      <a id="idMenuBilan" href="#">Bilan</a> 
                  </li>
     {% endif %}
{% endblock breadcrumb %}

{% block modal %}
  
     <div class="modal fade" id="modal_valider">
                 <div class="modal-dialog">
                   <div class="modal-content">
                     <div class="modal-header">
                       {#<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>#}
                       <h4 class="modal-title" id="idTitreGroupesSelectionnes">
                         Liste des {{ groupes | length }} groupes sélectionnés
                       </h4>
                     </div>
                     <div class="modal-body-sqe">
                             <div class="row">
                                <div class="col-md-offset-1 col-md-10">
                                    <div class="small">
                                        <table class="table table-bordered table-condensed table-advance" id="idTable1">
                                              <thead>
                                                 <tr>
                                                    <th>Code</th>
                                                    <th>Libellé</th>
                                                 </tr>
                                              </thead>
                                              <tbody id="idListeGroupesSelectionnes">
                                                  
                                              </tbody>
                                           </table>
                                  </div>
                                </div>
                              </div>
                      </div>
                      <div class="modal-footer">
                        <button id="idValiderSelection" type="submit" class="btn btn-success">
                             <i class="fa fa-archive"> Enregistrer</i>
                        </button>
                        <button id="idAnnulerSelection" type="button" class="btn btn-default" data-dismiss="modal">
                            <i class="fa fa-eraser"> Annuler</i>
                        </button>
                     </div>
                   </div>
                 </div>
            </div>    
    
    {%if groupes | length%}  
        {% for groupe in groupes %}
                                    
            <div class="modal fade" id="sup-{{ groupe.groupe.id }}">
                    <div class="modal-dialog modal-sm">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                          <h4 class="modal-title" id="supLabel-{{ groupe.groupe.id }}">Suppression du groupe {{ groupe.groupe.codeGrp}} {{ groupe.groupe.libelleGrp}}</h4>
                        </div>
                        <div class="modal-body">
                            <h4>Cliquer sur la corbeille pour valider la suppression</h4>
                            <br/><br/>
                            <div class="alert alert-danger">Attention : Une fois supprimée, la programmation de ce groupe sera supprimée définitivement</div>
                        </div>
                        <div class="modal-footer">
                           <button type="button" class="btn btn-defaut" data-dismiss="modal"><i class="fa fa-undo"></i> Annuler</button>
                          <a  id="idSupprimerGroupe"  class="btn btn-danger"  href="{{ path('AeagSqeBundle_programmation_programmeur_groupe_supprimer', { 'groupeId': groupe.groupe.id, 'lotan': lotan.id, 'action': action, 'maj': maj }) }}" title="Supprimer">
                              <i class="fa fa-trash-o"> Supprimer</i>
                            </a>
                         </div>
                      </div>
                    </div>
            </div>                                   
                                              
        {% endfor %}
    {% endif %}
                       
 
    <div class="modal  fade" id="modal_groupe_parametres" tabindex="-1" role="dialog" >
          <div class="modal-dialog" role="document">
              <div  id="idListeGroupeParametres" class="modal-content"></div>
          </div>
    </div>
    
    <div class="modal container fade" id="modal_milieu_groupe_parametres">
         <div class="modal-dialog">
             <div  id="idListeMilieuGroupeParametres" class="modal-content"></div>
         </div>
     </div>
    
            
{% endblock modal %}
              


{%block panel_heading %}
            <h3 class="page-title">
                {% if action == 'P'  and maj != 'V' %}
                  Choix des groupes de paramètres pour la programmation  {{ campagne }} version {{ lotan.version }} du lot : {{ lotan.lot.nomLot }}
                {% else %}
                  Groupes de paramètres impactés par la programmation {{ campagne }} version {{ lotan.version }} du lot : {{ lotan.lot.nomLot }}
                {% endif %}
              {# <a class="btn btn-primary pull-right" href="{{ path('AeagDecBundle_admin_pdfListeDechets') }}" title="Imprimer la lister"> 
                      <i class="fa fa-print"> Imprimer la liste</i>
               </a>#}
            </h3>
{%endblock panel_heading %}
       


 {%block content %}
     
    <div class="form-body">
        {% if messages | length %}
               <div class="alert alert-warning alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                {% for message in messages %}
                    <strong>{{ message }}</strong><br/>
                {% endfor %}   
               </div>
         {% endif %} 
        <form action="{{ path('AeagSqeBundle_programmation_groupe_resultat', { 'lotan': lotan.id, 'action': action, 'maj': maj}) }}" class="form-horizontal" id="idForm" method="post">
            <div class="row">
                <div class="col-xm-12 small">
                    <table class="table table-bordered table-condensed table-advance" id="idTable1">
                                  <thead>
                                     <tr>
                                          <th width="30%">Préléveur</th>
                                          <th width="30%">laboratoire</th>
                                        </tr>
                                  </thead>
                                  <tbody>
                                      <tr>
                                          <td>
                                            {% if action == 'P'  and maj != 'V' %}
                                                {%if preleveurs | length > 1 %} 
                                                  <select id="preleveur_ie" class="form-control input-small" placeholder="Préléveur" name="preleveur_ie" required="required" autocomplete>
                                                {% else %}
                                                  <select id="preleveur_ie" readonly  class="form-control input-small" placeholder="Préléveur" name="preleveur_ie" required="required" autocomplete>
                                                {% endif %}
                                                      <option value=""></option>
                                                      {%if preleveurs | length %}  
                                                          {% for preleveur in preleveurs %}
                                                              <option  value="{{ preleveur.adrCorId }}" >{{ preleveur.ancnumNomCorres }}</option>
                                                          {% endfor %}
                                                      {%endif%}
                                                 </select>
                                                 
                                               <input id="preleveur" name="preleveur" type="text" class="form-control input-small" placeholder="Preleveur" list="preleveurList" autofocus="autofocus" autocomplete="off">
                                                    <div>
                                                            <datalist id="preleveurList">
                                                                    {%if preleveurs | length %}  
                                                                        {% for preleveur in preleveurs %}
                                                                            <option  value="{{ preleveur.ancnumNomCorres }}" ></option>
                                                                        {% endfor %}
                                                                    {%endif%}
                                                            </datalist>
                                                    </div>
                                                 
                                                 
                                            {% else %}
                                                    <select id="preleveur" readonly  class="form-control input-small" placeholder="Préléveur" name="preleveur">
                                                      <option value=""></option>
                                                          {% for preleveur in preleveurs %}
                                                              <option  value="{{ preleveur.adrCorId }}" >{{ preleveur.ancnumNomCorres }}</option>
                                                          {% endfor %}
                                                 </select>
                                            {% endif %}
                                          </td>
                                          <td>
                                            {% if action == 'P'  and maj != 'V' %}
                                                    {%if laboratoires | length > 1 %}  
                                                      <select id="laboratoire_ie" class="form-control input-small" placeholder="Laboratoire" name="laboratoire_ie" required="required" autocomplete>
                                                    {% else %}
                                                      <select id="laboratoire_ie"  readonly class="form-control input-small" placeholder="Laboratoire" name="laboratoire_ie" required="required" autocomplete>
                                                    {% endif %}
                                                          <option value=""></option>
                                                          {%if laboratoires | length %}  
                                                              {% for laboratoire in laboratoires %}
                                                                  <option  value="{{ laboratoire.adrCorId }}" >{{ laboratoire.ancnumNomCorres }}</option>
                                                              {% endfor %}
                                                          {%endif%}
                                                     </select>
                                                     
                                                    <input id="laboratoire" name="laboratoire" type="text" class="form-control input-small" placeholder="Laboratoire" list="laboratoireList" autofocus="autofocus" autocomplete="off">
                                                    <div>
                                                            <datalist id="laboratoireList">
                                                                    {%if laboratoires | length %}  
                                                                        {% for laboratoire in laboratoires %}
                                                                            <option  value="{{ laboratoire.ancnumNomCorres }}" ></option>
                                                                        {% endfor %}
                                                                    {%endif%}
                                                            </datalist>
                                                    </div>
                                                     
                                            {% else %}
                                                    <select id="laboratoire"  readonly class="form-control input-small" placeholder="Laboratoire" name="laboratoire">
                                                          <option value=""></option>
                                                              {% for laboratoire in laboratoires %}
                                                                  <option  value="{{ laboratoire.adrCorId }}" >{{ laboratoire.ancnumNomCorres }}</option>
                                                              {% endfor %}
                                                    </select>
                                            {% endif %}
                                          </td>
                                      </tr>
                                 </tbody>
                               </table>
                </div>
                 <div class="col-md-offset-5 col-md-9">
                    <button id="idGroupeSuivant" type="button" class="btn btn-defaut">
                             <i class="fa fa-level-down"> Suivant</i>
                     </button>
                 </div>
             </div> 
       
              <div class="row">
                <div id="idGroupeAll" class="col-xm-12">
                    <div class="panel panel-default">
                      <div class="panel-body">
                            <ul  class="nav nav-pills nav-justified" role="tablist">
                              <li id="idGroupesChoisis" class="active"><a href="#tab_1_1" data-toggle="tab"><h4>Groupes de paramètres choisis  </h4></a></li>
                               {% if action == 'P'  and maj != 'V' %}
                                 <li id="idGroupesAjoutes" class=""><a href="#tab_1_2" data-toggle="tab"><h4>Ajouter d'autres groupes de paramètres </h4></a></li>
                               {% endif %}
                            </ul>
                            <div  class="tab-content">
                            <div class="tab-pane fade active in" id="tab_1_1">
                                   <div id='idGroupes'>
                                        <div class="small">
                                           <table class="table table-bordered table-condensed table-advance" id="idTable">
                                          <thead>
                                             <tr>
                                                 <th width="5%">Actions</th>
                                                 <th>Code</th>
                                                  <th>Libelle</th>
                                                  <th>Type</th>
                                                  <th>Support</th>
                                                  <th>Prestataire</th>
                                                  <th width="5%">Parametres</th>
                                                  </tr>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                 </tr>
                                          </thead>
                                          <tbody>
                                              {%if groupes | length%}  
                                                  {% for groupe in groupes %}
                                                        {% if groupe.origine == 'RC' %}
                                                        <tr id='idGroupe_{{ groupe.groupe.id }}' name='idGroupe_{{ groupe.groupe.id }}>
                                                           <td></td>
                                                        {% elseif  groupe.origine == 'R'  %}
                                                        <tr id='idGroupe_{{ groupe.groupe.id }}' name='idGroupe_{{ groupe.groupe.id }}'> 
                                                          <td></td>
                                                        {% elseif groupe.origine == 'A' %}
                                                         <tr id='idGroupe_{{ groupe.groupe.id }}' name='idGroupe_{{ groupe.groupe.id }}'>
                                                            <td align="center" nowrap>
                                                                {% if action == 'P'  and maj != 'V' %}
                                                                    <a class="btn btn-danger" data-toggle="modal" href="#sup-{{ groupe.groupe.id }}" title="Supprimer">
                                                                    <i class="fa fa-trash-o"></i>
                                                                  </a>
                                                                {% endif %}
                                                             </td>
                                                        {% else %}
                                                            <tr id='idGroupe_{{ groupe.groupe.id }}' name='idGroupe_{{ groupe.groupe.id }}' >
                                                             <td></td>
                                                      {% endif %}
                                                          <td>
                                                              <input type="hidden" id="idValide_{{ groupe.groupe.id }}" name="idValide_{{ groupe.groupe.id }}" value="{{groupe.valide}}">
                                                              {{ groupe.groupe.codeGrp}}
                                                          </td>
                                                          <td>{{ groupe.groupe.libelleGrp}}</td>
                                                          <td>{{ groupe.groupe.typeGrp }}</td>
                                                          <td>{% if groupe.groupe.support | length %}
                                                                {{ groupe.groupe.support.nomSupport }}
                                                              {% endif %}
                                                          </td>
                                                          <td>
                                                              <input type="hidden" id="idPrestataire_{{ groupe.groupe.id }}" name="idPrestataire_{{ groupe.groupe.id }}" value="">
                                                              {% if groupe.groupe.typeGrp  == 'ANA' %}
                                                                 {% if action == 'P'  and maj != 'V' %}
                                                                        {%if laboratoires | length > 1 %}  
                                                                          <select id="prestataire_{{ groupe.groupe.id }}_ie" class="form-control input-small" placeholder="Prestataire" name="prestataire_{{ groupe.groupe.id }}" required="required">
                                                                        {% else %}
                                                                          <select id="prestataire_{{ groupe.groupe.id }}_ie"  readonly class="form-control input-small" placeholder="Prestataire" name="prestataire_{{ groupe.groupe.id }}" required="required">
                                                                        {% endif %}
                                                                              <option value=""></option>
                                                                              {%if laboratoires | length %}  
                                                                                  {% for laboratoire in laboratoires %}
                                                                                      <option  value="{{ laboratoire.adrCorId }}" >{{ laboratoire.ancnumNomCorres }}</option>
                                                                                  {% endfor %}
                                                                              {%endif%}
                                                                         </select>
                                                                         
                                                                         <input id="prestataire_{{ groupe.groupe.id }}" name="prestataire_{{ groupe.groupe.id }}" type="text" class="form-control input-small" placeholder="Prestataire" list="prestataireList" autofocus="autofocus">
                                                                            <div>
                                                                                    <datalist id="prestataireList">
                                                                                            {%if laboratoires | length %}  
                                                                                                {% for laboratoire in laboratoires %}
                                                                                                    <option  value="{{ laboratoire.ancnumNomCorres }}" ></option>
                                                                                                {% endfor %}
                                                                                            {%endif%}
                                                                                    </datalist>
                                                                            </div>
                                                                         
                                                                         
                                                                {% else %}
                                                                       {% if groupe.prestataire %}
                                                                           {{ groupe.prestataire.nomCorres }}
                                                                       {% endif %}
                                                                {% endif %}
                                                               {% else %}
                                                                    {% if app.session.get('browser') == 'Internet Explorer' %}
                                                                         <div id="prestataire_{{ groupe.groupe.id }}_ie">
                                                                    {% else %}
                                                                         <div id="prestataire_{{ groupe.groupe.id }}">
                                                                    {% endif %}
                                                                      {% if groupe.prestataire %}
                                                                        {{ groupe.prestataire.nomCorres }}
                                                                      {% endif %}
                                                                   </div>
                                                              {% endif %}
                                                         </td>
                                                          <td id="idTd_{{ groupe.groupe.id }}" align="center">
                                                              {% if groupe.parametres | length %}
                                                                  {% if groupe.valide == 'O' %}
                                                                        <a id="idBtGroupeParametres_{{ groupe.groupe.id }}" class="btn btn-success" data-backdrop="false" data-toggle="modal" href="#" title="Paramètres">
                                                                  {% else %}
                                                                        <a id="idBtGroupeParametres_{{ groupe.groupe.id }}" class="btn btn-info" data-backdrop="false" data-toggle="modal" href="#" title="Paramètres">
                                                                  {% endif %}
                                                                    <span id="idNbParametres_{{ groupe.groupe.id }}" class="badge badge-important ">{{ groupe.parametres.nbPgProgGrparRefLstParam }}</span>
                                                                </a>
                                                             {% endif %}
                                                          </td>
                                                         </tr>
                                                  {% endfor %}
                                              {% endif %}
                                          </tbody>
                                  </table>   
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-10 pull-left text-info">
                                         <ul class="list-inline">
                                           <li><a class="btn btn-info btn-xs" href="#" title="Paramètres à valider"><i class="fa"></i></a> A valider</li>
                                           <li><a class="btn btn-success btn-xs" href="#" title="paramètre validés"><i class="fa" ></i></a> Valider</li>
                                          </ul>  
                                       </div>
                                     </div>
                                    <div class="form-actions fluid center">
                                        
                                       <div class="col-md-offset-5 col-md-9">
                                            {% if action == 'P'  and maj != 'V' %}
                                                <a id="idValider" class="btn btn-success" data-toggle="modal" href="#" title="Valider">
                                                    <i class="fa fa-share"> Suivant</i>
                                                </a>
                                            {% else %}
                                                <button id="idSubmit" type="submit" class="btn btn-success icon-ok-sign">
                                                   <i class="fa fa-eye"> Suivant</i>
                                                </button>
                                            {% endif %}
                                          </div>
                                    </div>  
                            </div>
                            <div class="tab-pane fade" id="tab_1_2">
                                     <div id='idGroupesMilieu'>
                                           <div class="small">
                                               <table class="table table-bordered table-condensed table-advance" id="idTableMilieu">
                                               <caption>
                                                   <div class="panel-heading">
                                                     <div class="row">
                                                            <div class="col-md-2  text-center" id="idNbCocher">
                                                             <p class="btn btn-primary"></p>
                                                            </div>
                                                            <div class="col-md-3 text-right">
                                                                Rechercher à partir du parametre:
                                                            </div>
                                                            <div class="col-md-3 ">
                                                               
                                                                    <select id="idParametres" name="parametres" class="form-control input-small" placeholder="Parametre" name="parametre" autocomplete >
                                                                    <option value=""></option>
                                                                    {%if parametres | length%}  
                                                                        {% for parametre in parametres %}
                                                                            <option  value="{{ parametre.codeParametre }}" >{{ parametre.codeParametre }} {{ parametre.nomParametre }}</option>
                                                                        {% endfor %}
                                                                    {%endif%}
                                                                  </select>
                                                                    <input id="idParametre" name="parametre" type="text" class="form-control input-small" placeholder="Parametre" list="parametreList" autofocus="autofocus">
                                                                            <div>
                                                                                    <datalist id="parametreList">
                                                                                            {%if parametres | length%}  
                                                                                                {% for parametre in parametres %}
                                                                                                    <option  value="{{ parametre.codeParametre }} {{ parametre.nomParametre }}" ></option>
                                                                                                {% endfor %}
                                                                                            {%endif%}
                                                                                    </datalist>
                                                                            </div>
                                                               </div>
                                                            <div class="col-md-2">
                                                                <button id="idSelectonParametre" type="button" class="btn btn-primary">
                                                                        <i class="fa fa-search-plus"> Rechercher</i>
                                                                 </button>
                                                             </div>
                                                        </div>
                                                     </div>
                                               </caption>
                                                 <thead>
                                                    <tr>
                                                        <th width="5%">Sélectionner</th>
                                                        <th>Code</th>
                                                         <th>Libelle</th>
                                                         <th>Type</th>
                                                         <th>Support</th>
                                                         <th width="5%">Parametres</th>

                                                       </tr>
                                                       <tr>
                                                           <td></td>
                                                           <td></td>
                                                           <td></td>
                                                           <td></td>
                                                           <td></td>
                                                           <td></td>
                                                       </tr>
                                                 </thead>
                                                 <tbody>
                                                     {%if groupesMilieu | length%}  
                                                         {% for groupe in groupesMilieu %}
                                                            <tr id='idGroupe_{{ groupe.groupe.id }}' name='idGroupe_{{ groupe.groupe.id }}'>
                                                                 <td align="center">
                                                                     <div class="checbox">
                                                                          {% if groupe.cocher == 'O' %}
                                                                               <input type="checkbox" id="check_{{ groupe.groupe.id }}" name="check[]" value="{{groupe.groupe.id}}" checked="checked">
                                                                          {% else %}    
                                                                               <input type="checkbox" id="check_{{ groupe.groupe.id }}" name="check[]" value="{{groupe.groupe.id}}">
                                                                          {% endif %}
                                                                     </div><!-- /input-group -->
                                                                  </td> 
                                                                <td>{{ groupe.groupe.codeGrp}}</td>
                                                                 <td>{{ groupe.groupe.libelleGrp}}</td>
                                                                 <td>{{ groupe.groupe.typeGrp }}</td>
                                                                 <td>{% if groupe.groupe.support | length %}
                                                                       {{ groupe.groupe.support.nomSupport }}
                                                                     {% endif %}
                                                                 </td>
                                                                 <td align="center">
                                                                        <a id="idBtMilieuGroupeParametres_{{ groupe.groupe.id }}" class="btn btn-info" data-toggle="modal" href="#" title="Paramètres">
                                                                           <i class="fa fa-eye"></i>
                                                                       </a>
                                                                 </td>
                                                             </tr>
                                                         {% endfor %}
                                                     {% endif %}
                                                 </tbody>
                                         </table>   
                                          </div>
                                      </div>
                                       <div class="form-actions fluid center">
                                           <div class="col-md-offset-5 col-md-9">
                                              <button id="idAjouterGroupe" type="button" class="btn btn-success">
                                                       <i class="fa fa-check"> Ajouter les groupes sélectionnés</i>
                                               </button>
                                           </div>
                                       </div>       
                               </div>
                          </div>
                        </div>
                    </div>
                 </div>
            </div>
                                                 
            <input type="hidden" name="suivant" id="idSuivant" value="periode">
        </form>
      </div> 
                        
       {% if action == 'P'  and maj != 'V' %}
     <div class="progress" style="height: 50px;padding: 5px 5px;">
                   {% if controle.station.ok == 1 %}
                            <div class="progress-bar progress-bar-success progress-bar-striped active" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantStation" href="#">Stations
                                        <span class="btn btn-success">
                                           <span class="badge">
                                              {{ controle.station.nb  |  number_format(0,'.',' ')}}
                                           </span>
                                       </span>
                                    </a>
                              </div>
                    {% else %}
                            <div class="progress-bar progress-bar-danger progress-bar-striped active" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantStation" href="#">Stations
                                        <span class="btn btn-danger">
                                             <span class="badge">
                                                 {{ controle.station.nb  |  number_format(0,'.',' ')}}
                                              </span>
                                         </span>
                                    </a>
                             </div>
                    {% endif %}
                    {% if  controle.groupe.ok == 1 %}
                            <div class="progress-bar progress-bar-success" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantGroupe" href="#">Groupes de parametres
                                        <span class="btn btn-success">
                                           <span class="badge">
                                              {{ controle.groupe.nb  |  number_format(0,'.',' ')}}
                                           </span>
                                       </span>
                                    </a>
                            </div>
                    {% else %}
                            <div class="progress-bar progress-bar-danger" style="width: 25%;font-size: 16px;line-height: 35px;">
                                   <a id="idSuivantGroupe" href="#">Groupes de parametres
                                        <span class="btn btn-danger">
                                             <span class="badge">
                                                {{ controle.groupe.nbValide  |  number_format(0,'.',' ')}}/{{ controle.groupe.nb  |  number_format(0,'.',' ')}}
                                              </span>
                                         </span>
                                   </a>
                             </div>
                    {% endif %}
                    {% if controle.periode.ok == 1 %}
                            <div class="progress-bar progress-bar-success" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantPeriode" href="#">Périodes
                                         <span class="btn btn-success">
                                            <span class="badge">
                                                {{ controle.periode.nb  |  number_format(0,'.',' ')}}
                                             </span>
                                        </span>
                                    </a> 
                           </div>
                      {% else %}
                            <div class="progress-bar progress-bar-danger" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantPeriode" href="#">Périodes
                                         <span class="btn btn-danger">
                                            <span class="badge">
                                                {{ controle.periode.nb  |  number_format(0,'.',' ')}}
                                             </span>
                                        </span>
                                     </a> 
                           </div>
                      {% endif %}
                       {% if controle.station.nbOk == controle.station.nb and  controle.groupe.nbOk == controle.groupe.nb and controle.periode.nbOk == controle.periode.nb %}
                            <div class="progress-bar progress-bar-success" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantBilan" href="#">Bilan</a> 
                           </div>
                       {% else %}
                            <div class="progress-bar progress-bar-danger" style="width: 25%;font-size: 16px;line-height: 35px;">
                                    <a id="idSuivantBilan" href="#">Bilan</a> 
                           </div>
                       {% endif %}
             </div>
     {% endif %}

  {%endblock content %}
 

 {% block scripts %}
     
     $('#idGroupeSuivant').hide();
     
      var table1 = $('#idTable1').DataTable();
 
      {% if app.session.get('browser') == 'Internet Explorer' %}
           $('#idParametres').show();
           $('#idParametre').hide();
           $('#preleveur_ie').show();
           $('#preleveur').hide();
           $('#laboratoire_ie').show();
           $('#laboratoire').hide();
           {% if app.session.get('selectionPreleveur_ie')   %}
                var valeur = {{ app.session.get('selectionPreleveur_ie') }};
                $("#preleveur_ie option[value='" + valeur + "']").attr('selected','selected');
                $("#preleveur_ie").val(valeur);
           {% endif %}
            {% if app.session.get('selectionLaboratoire_ie')   %}
                 $('#laboratoire_ie option:selected').removeAttr('selected');
                var valeur = {{ app.session.get('selectionLaboratoire_ie') }};
                $("#laboratoire_ie option[value='" + valeur + "']").attr('selected','selected');
                $("#laboratoire_ie").val(valeur);
          {% endif %}
           // si pas sélectionner préleveur ou laboratoire alors liste des groupes cachée
            preleveur = $('#preleveur_ie option:selected').val();
            laboratoire = $('#laboratoire_ie option:selected').val();
            if (preleveur == '' || laboratoire == '') {
               $('#idGroupeAll').hide();
               $('#idGroupeSuivant').show();
            };
            {%if groupes | length%}  
                {% for groupe in groupes %}
                      $('#prestataire_{{ groupe.groupe.id }}_ie').show();
                      $('#prestataire_{{ groupe.groupe.id }}').hide();
                {% endfor %}
            {% endif %}
        {% else %}
           $('#idParametres').hide();
           $('#idParametre').show();
           $('#preleveur_ie').hide();
           $('#preleveur').show();
           $('#laboratoire_ie').hide();
           $('#laboratoire').show();
           {% if app.session.get('selectionPreleveur')   %}
                    var valeur = remplacer('{{ app.session.get('selectionPreleveur') }}');
                     $("#preleveur").val(unescape(escape(valeur)));
              {% endif %}
             {% if app.session.get('selectionLaboratoire')   %}
                    var valeur = remplacer('{{ app.session.get('selectionLaboratoire') }}');
                    $("#laboratoire").val(unescape(escape(valeur)));
              {% endif %}
                // si pas sélectionner préleveur ou laboratoire alors liste des groupes cachée
                preleveur = $('#preleveur').val();
                laboratoire = $('#laboratoire').val();
                if (preleveur == '' || laboratoire == '') {
                   $('#idGroupeAll').hide();
                   $('#idGroupeSuivant').show();
                };
                 {%if groupes | length%}  
                {% for groupe in groupes %}
                      $('#prestataire_{{ groupe.groupe.id }}_ie').hide();
                      $('#prestataire_{{ groupe.groupe.id }}').show();
                {% endfor %}
            {% endif %}
       {% endif %}
    
      $(document).on('click','#preleveur',function(e){
           $('#idGroupeAll').show();
           $('#idGroupeSuivant').hide()
      });
         
     $(document).on('change','#preleveur',function(e){
        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
        valeur = $('#preleveur').val();
        texte =  $('#preleveur').text();  
        preleveur = $('#preleveur').val();
        laboratoire = $('#laboratoire').val();
        if (preleveur == '' || laboratoire == ''){
           $('#idGroupeAll').hide();
           $('#idGroupeSuivant').show();
        }else{
           $('#idGroupeAll').show();
           $('#idGroupeSuivant').hide();
        }
        var nbRecords = $('#idTable_length option:selected').val();
        table.page.len( -1 ).draw();
        {%if groupes | length%}  
            {% for groupe in groupes %}
                {% if action == 'P'  and maj != 'V'  %}
                     {% if groupe.groupe.typeGrp  != 'ANA' %}
                         $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                         $("#prestataire_{{ groupe.groupe.id }}").empty().append(valeur);
                         if (!valeur){
                           $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                           $('#idValide_{{ groupe.groupe.id }}').val('N');
                        }
                       {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
       table.page.len( nbRecords ).draw();
      }); 
      
          $(document).on('change','#preleveur_ie',function(e){
        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
        valeur = $('#preleveur_ie option:selected').val();
        texte =  $('#preleveur_ie option:selected').text();  
        preleveur = $('#preleveur_ie option:selected').val();
        laboratoire = $('#laboratoire_ie option:selected').val();
        if (preleveur == '' || laboratoire == ''){
           $('#idGroupeAll').hide();
           $('#idGroupeSuivant').show();
        }else{
           $('#idGroupeAll').show();
           $('#idGroupeSuivant').hide();
        }
        var nbRecords = $('#idTable_length option:selected').val();
        table.page.len( -1 ).draw();
        {%if groupes | length%}  
            {% for groupe in groupes %}
                {% if action == 'P'  and maj != 'V'  %}
                     {% if groupe.groupe.typeGrp  != 'ANA' %}
                         $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                         $("#prestataire_{{ groupe.groupe.id }}_ie").empty().append(texte);
                         if (!valeur){
                           $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                           $('#idValide_{{ groupe.groupe.id }}').val('N');
                        }
                       {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
       table.page.len( nbRecords ).draw();
      }); 
      
    $(document).on('change','#laboratoire',function(e){
        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
        valeur = $('#laboratoire').val();
        texte =  $('#laboratoire').text();
        preleveur = $('#preleveur').val();
        laboratoire = $('#laboratoire').val();
        if (preleveur == '' || laboratoire == ''){
           $('#idGroupeAll').hide();
           $('#idGroupeSuivant').show();
        }else{
           $('#idGroupeAll').show();
           $('#idGroupeSuivant').hide();
        }
        var nbRecords = $('#idTable_length option:selected').val();
        table.page.len( -1 ).draw();
         {%if groupes | length%}  
            {% for groupe in groupes %}
                {% if action == 'P'  and maj != 'V'  %}
                    {% if groupe.groupe.typeGrp  == 'ANA' %}
                           $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                          $("#prestataire_{{ groupe.groupe.id }}").val(valeur);
                          var requestData = {
                                              groupe : {{ groupe.groupe.id }},
                                              prestataire : valeur,
                                              }
                          var url = '{{ path("AeagSqeBundle_programmation_groupe_parametre_prestataires",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                          url = url.replace("par1", '{{ action }}');
                          url = url.replace("par2", '{{ maj }}');
                          url = url.replace("amp;","");
                          url = url.replace("par3", '{{ lotan.id }}');
                          url = url.replace("amp;","");
                          $.get( url, requestData , function( responseData ) { 
                               $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                                  $('#idValide_{{ groupe.groupe.id }}').val('N');
                          });
                     {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
        table.page.len( nbRecords ).draw();
      });    
      
       $(document).on('change','#laboratoire_ie',function(e){
        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
        valeur = $('#laboratoire_ie option:selected').val();
        texte =  $('#laboratoire_ie option:selected').text();
        preleveur = $('#preleveur_ie option:selected').val();
        laboratoire = $('#laboratoire_ie option:selected').val();
        if (preleveur == '' || laboratoire == ''){
           $('#idGroupeAll').hide();
           $('#idGroupeSuivant').show();
        }else{
           $('#idGroupeAll').show();
           $('#idGroupeSuivant').hide();
        }
        var nbRecords = $('#idTable_length option:selected').val();
        table.page.len( -1 ).draw();
         {%if groupes | length%}  
            {% for groupe in groupes %}
                {% if action == 'P'  and maj != 'V'  %}
                    {% if groupe.groupe.typeGrp  == 'ANA' %}
                           $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                           $("#prestataire_{{ groupe.groupe.id }}_ie option[value='" + valeur + "']").attr('selected','selected');
                           $("#prestataire_{{ groupe.groupe.id }}_ie").val(valeur);
                           var requestData = {
                                              groupe : {{ groupe.groupe.id }},
                                              prestataire : valeur,
                                              }
                          var url = '{{ path("AeagSqeBundle_programmation_groupe_parametre_prestataires",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                          url = url.replace("par1", '{{ action }}');
                          url = url.replace("par2", '{{ maj }}');
                          url = url.replace("amp;","");
                          url = url.replace("par3", '{{ lotan.id }}');
                          url = url.replace("amp;","");
                          $.get( url, requestData , function( responseData ) { 
                               $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                                  $('#idValide_{{ groupe.groupe.id }}').val('N');
                          });
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
        table.page.len( nbRecords ).draw();
      });    

    
      {% if app.session.get('browser') == 'Internet Explorer' %}
            valeur = $('#preleveur_ie option:selected').val();
            texte =  $('#preleveur_ie option:selected').text();
      {% else %}
            valeur = $('#preleveur').val();
            texte =  $('#preleveur').text();
      {% endif %}
      
     {%if groupes | length%}  
        {% for groupe in groupes %}
         
            {% if groupe.prestataire %}
                {% if app.session.get('browser') == 'Internet Explorer' %}
                    valeur = {{ groupe.prestataire.adrCorId }};
                    texte =  remplacer1('{{ groupe.prestataire.ancnumNomCorres }}');
                 {% else %}
                     valeur = remplacer1( '{{ groupe.prestataire.ancnumNomCorres }}');
                     texte = remplacer1( '{{ groupe.prestataire.ancnumNomCorres }}');
                  {% endif %}
           {% endif %}
           $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
            
            {% if action == 'P'  and maj != 'V'  %}
             
                if (valeur){
                    {% if groupe.valide == 'N' %}
                       $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                    {% else %}
                       $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-info").addClass("btn-success");
                     {% endif %}
                      $('#idValide_{{ groupe.groupe.id }}').val('{{ groupe.valide }}');
                   {% if groupe.groupe.typeGrp  != 'ANA' %}
                       {% if app.session.get('browser') == 'Internet Explorer' %}
                           $("#prestataire_{{ groupe.groupe.id }}_ie").empty().append(texte);
                       {% else %}
                           $("#prestataire_{{ groupe.groupe.id }}").empty().append(texte);
                        {% endif %}
                  {% endif %}
                  {% if groupe.groupe.typeGrp  == 'ANA' %}
                      {% if app.session.get('browser') == 'Internet Explorer' %}
                                $("#prestataire_{{ groupe.groupe.id }}_ie option[value='" + valeur + "']").attr('selected','selected');
                                $("#prestataire_{{ groupe.groupe.id }}_ie").val(valeur);
                                $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                                $(document).on('change','#prestataire_{{ groupe.groupe.id }}_ie',function(e){
                                        valeur = $('#prestataire_{{ groupe.groupe.id }}_ie option:selected').val();
                                        $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                                       var requestData = {
                                              groupe : {{ groupe.groupe.id }},
                                              prestataire : valeur,
                                              }
                                        var url = '{{ path("AeagSqeBundle_programmation_groupe_parametre_prestataires",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                                        url = url.replace("par1", '{{ action }}');
                                        url = url.replace("par2", '{{ maj }}');
                                        url = url.replace("amp;","");
                                        url = url.replace("par3", '{{ lotan.id }}');
                                        url = url.replace("amp;","");
                                        $.get( url, requestData , function( responseData ) { 
                                             $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                                                $('#idValide_{{ groupe.groupe.id }}').val('N');
                                        });
                                 }); 
                         {% else %}
                               $("#prestataire_{{ groupe.groupe.id }} option[value='" + valeur + "']").attr('selected','selected');
                                $("#prestataire_{{ groupe.groupe.id }}").val(valeur);
                                $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                                $(document).on('change','#prestataire_{{ groupe.groupe.id }}',function(e){
                                        valeur = $('#prestataire_{{ groupe.groupe.id }}').val();
                                        $("#idPrestataire_{{ groupe.groupe.id }}").val(valeur);
                                        var requestData = {
                                              groupe : {{ groupe.groupe.id }},
                                              prestataire : valeur,
                                              }
                                        var url = '{{ path("AeagSqeBundle_programmation_groupe_parametre_prestataires",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                                        url = url.replace("par1", '{{ action }}');
                                        url = url.replace("par2", '{{ maj }}');
                                        url = url.replace("amp;","");
                                        url = url.replace("par3", '{{ lotan.id }}');
                                        url = url.replace("amp;","");
                                        $.get( url, requestData , function( responseData ) { 
                                             $("#idTd_{{ groupe.groupe.id }} a").removeClass("btn-success").addClass("btn-info");
                                                $('#idValide_{{ groupe.groupe.id }}').val('N');
                                        });
                                 });  
                         {% endif %}
                   {% endif %}
                 }
                  
            {% endif %}
            
            $("#idNbParametres_{{ groupe.groupe.id }}").empty().append({{ groupe.parametres.nbPgProgLotParamAns}} + '/' + {{ groupe.parametres.nbPgProgGrparRefLstParam }} );
                
            $(document).on('click','#idBtGroupeParametres_{{ groupe.groupe.id }}',function(e){
            $('#modalTraitementEncours').modal('toggle');
               e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
               var prestataire = $("#idPrestataire_{{ groupe.groupe.id }}").val();
               if (!prestataire){
                   alert('renseigner le prestataire');
               }else{
                    var requestData = {
                                        groupe : {{ groupe.groupe.id }},
                                        prestataire : $("#idPrestataire_{{ groupe.groupe.id }}").val(),
                                        }
                    var url = '{{ path("AeagSqeBundle_programmation_groupe_parametres",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                    url = url.replace("par1", '{{ action }}');
                    url = url.replace("par2", '{{ maj }}');
                    url = url.replace("amp;","");
                    url = url.replace("par3", '{{ lotan.id }}');
                    url = url.replace("amp;","");
                    $.get( url, requestData , function( responseData ) { 
                         $("#idListeGroupeParametres" ).empty().html( responseData ); 
                         $('#modal_groupe_parametres').modal();
                         $('#modalTraitementEncours').modal('hide');
                    });
               }
            });
            
            $("#sup-{{ groupe.groupe.id }}").draggable({
                handle: ".modal-header"
            });   
            
        {% endfor %}
    {% else %}
        $('#idGroupesChoisis').removeClass("active");
        $('#tab_1_1').removeClass("active").removeClass("in");
        $('#idGroupesAjoutes').addClass("active");
        $('#tab_1_2').addClass("active").addClass("in");
    {% endif %}
    
      
   
     $(document).on('click', '#idValider',function(e){
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
            }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
          $(document).on('click', '#idMenuStation',function(e){
              $('#idSuivant').val('station');
               {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
               $('#modalTraitementEncours').modal('hide');
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
         $(document).on('click', '#idMenuPeriode',function(e){
              $('#idSuivant').val('periode');
               {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
              $('#modalTraitementEncours').modal('hide');
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
            }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
         $(document).on('click', '#idMenuBilan',function(e){
          {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
            $('#idSuivant').val('bilan');
            $('#modalTraitementEncours').modal('hide');
            var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
            $(document).on('click', '#idSuivantStation',function(e){
              $('#idSuivant').val('station');
               {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
         $(document).on('click', '#idSuivantGroupe',function(e){
              $('#idSuivant').val('groupe');
             {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
           
         $(document).on('click', '#idSuivantPeriode',function(e){
              $('#idSuivant').val('periode');
               {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
              var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
          
         $(document).on('click', '#idSuivantBilan',function(e){
              $('#idSuivant').val('bilan');
              {% if action != 'P' or (action == 'P' and  maj == 'V') %}
                     $('#modalTraitementEncours').modal();
                    $('#idForm').submit();
              {% endif %}
             var nbRecords = $('#idTable_length option:selected').val();
             table.page.len( -1 ).draw();
             var html = '';
             var nbValider = 0;
             var nbgroupe = 0;
            {%if groupes | length%}  
               {% for groupe in groupes %}
                   if ($('#idValide_{{ groupe.groupe.id }}').val() == 'O'){
                        nbValider = nbValider + 1;
                   }
                   if (nbgroupe == 0){
                       html = '<tr>';
                      }else{
                        html = html + '<tr>';
                      };
                        html = html + '<td>';
                        html = html + '{{ groupe.groupe.codeGrp}}';
                        html = html + '</td>';
                        html = html + '<td>{{ groupe.groupe.libelleGrp}}</td>';
                        html = html + '</tr>';
                       nbgroupe = nbgroupe + 1;
                {% endfor %}
            {% endif %}
            table.page.len( nbRecords ).draw();
            if ( nbValider == {{ groupes | length }}){
                table1.destroy();
                $('#idListeGroupesSelectionnes').empty().append(html);
                table1 = $('#idTable1').DataTable(
                {"stateSave": false,
                 "order": [[ 0, "asc" ]],
                "oLanguage": {
                "sSearch": "Filtre",
                "sFirst": "1ere page",
                "sLast": "Dernière page",
                "sNext": "Prochaine page",
                "sPrevious": "Page précédente",
                "EmptyTable": "Pas de données",
                "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                "sZeroRecords": "Pas d'enregistrement à afficher",
                "sInfoEmpty": "Pas d'enregistrement à afficher",
                "sInfoThousands": " ",
                "sLengthMenu": 'Afficher <select>' +
                    '<option value="10">10</option>' +
                    '<option value="20">20</option>' +
                    '<option value="30">30</option>' +
                    '<option value="40">40</option>' +
                    '<option value="50">50</option>' +
                    '<option value="-1">Tous</option>' +
                    '</select> enregistrements',
                "sPaginationType": "full_numbers"
                }
                }
                );
                $('#modal_valider').modal();
           }else{
                html = 'Vous devez valider tous les paramètres avant de pouvoir valider tous les groupes';
                $('#idModalMessageErreur').empty().append(html);
                $('#modalMessageErreur').modal();
            };
          });
           
           
          
    $(document).on('click', '#idAnnulerSelection',function(e){
            $('#modal_valider').modal('hide');
        });
         
    $(document).on('click', '#idValiderSelection',function(e){
            $('#modal_valider').modal('hide');
            $('#modalTraitementEncours').modal('toggle');
            $('#idForm').submit();
         });
         
    $(document).on('click', '#idSupprimerGroupe',function(e){
             $(document).on('click', '#idSupprimerGroupe',function(e){  $('#modalTraitementEncours').modal('toggle')});
          });
   
    $(document).on('click','#idAjouterGroupe',function(e){
        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
        $('#modalTraitementEncours').modal('toggle');
        tableMilieu.page.len( -1 ).draw();
        var $this = $('#idForm'); // L'objet jQuery du formulaire
        var url = '{{ path("AeagSqeBundle_programmation_groupe_ajouter",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
        url = url.replace("par1", '{{ action }}');
        url = url.replace("par2", '{{ maj }}');
        url = url.replace("amp;","");
        url = url.replace("par3", '{{ lotan.id }}');
        url = url.replace("amp;","");
        $.ajax({
                 url: url, // Le nom du fichier indiqué dans le formulaire
                 type: 'POST', // La méthode indiquée dans le formulaire (get ou post)
                data: $this.serialize(), // Je sérialise les données (j'envoie toutes les valeurs présentes dans le formulaire)
                success: function(html) { // Je récupère la réponse du fichier PHP
                    var url = '{{ path("AeagSqeBundle_programmation_groupes",{"action": "par1","maj":"par2","lotan":"par3"}) }}';
                    url = url.replace("par1", '{{ action }}');
                    url = url.replace("par2", '{{ maj }}');
                    url = url.replace("amp;","");
                    url = url.replace("par3", '{{ lotan.id }}');
                    url = url.replace("amp;","");
                    $(location).attr('href',url);
                    return false;
                    }
         });
     }); 
                 
    {%if groupesMilieu| length%}  
        {% for groupe in groupesMilieu %}
            
              $(document).on('click','#idBtMilieuGroupeParametres_{{ groupe.groupe.id }}',function(e){
                    e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                    $('#modalTraitementEncours').modal('toggle');
                    var requestData = {
                                        groupe : $('#check_{{ groupe.groupe.id }}').val(),
                                        }
                    var url = '{{ path("AeagSqeBundle_programmation_milieu_groupe_parametres",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                    url = url.replace("par1", '{{ action }}');
                    url = url.replace("par2", '{{ maj }}');
                    url = url.replace("amp;","");
                    url = url.replace("par3", '{{ lotan.id }}');
                    url = url.replace("amp;","");
                    $.get( url, requestData , function( responseData ) { 
                         $("#idListeMilieuGroupeParametres" ).empty().html( responseData ); 
                         $('#modal_milieu_groupe_parametres').modal();
                         $('#modalTraitementEncours').modal('hide');
                    });
                 });
                 
                  $(document).on('click','#check_{{ groupe.groupe.id }}',function(e){
                    nbcocher();
                 });
        {% endfor %}
    {% endif %}         
                 
    {% if app.session.get('choixParametre')   %}
           $('#idParametres option:selected').removeAttr('selected');
           var valeur = {{ app.session.get('choixParametre') }};
           $("#idParametres option[value='" + valeur + "']").attr('selected','selected');
           $("#idParametres').val(valeur);
           $('#idParametre').val(valeur);
      {% endif %}
      
       $(document).on('change','#idParametres',function(e){
                   texte = $('#idParametres option:selected').text();
                   $('#idParametre').val(texte);
       });    
       
       $(document).on('change','#idParametre',function(e){
           $('#idParametres option:selected').removeAttr('selected');
           var texte = $('#idParametre').val();
           var valeur = texte.substr(0, 4)
           $("#idParametres option[value='" + valeur + "']").attr('selected','selected');
           $("#idParametres").val(valeur);
       });    
     
                 
       $(document).on('click','#idSelectonParametre',function(e){
                   e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                   $('#modalTraitementEncours').modal('toggle');
                    var $this = $('#idForm'); // L'objet jQuery du formulaire
                    var url = '{{ path("AeagSqeBundle_programmation_groupe_filtrer",{"action": "par1","maj":"par2","lotan":"par3"}) }}', // Le nom du fichier indiqué dans le formulaire
                    url = url.replace("par1", '{{ action }}');
                    url = url.replace("par2", '{{ maj }}');
                    url = url.replace("amp;","");
                    url = url.replace("par3", '{{ lotan.id }}');
                    url = url.replace("amp;","");
                    $.ajax({
                            url: url, // Le nom du fichier indiqué dans le formulaire
                            type: 'GET', // La méthode indiquée dans le formulaire (get ou post)
                            data: $this.serialize(),
                            success: function(html) { // Je récupère la réponse du fichier PHP
                                 $("#idGroupesMilieu" ).empty().html( html ); 
                                 $('#modalTraitementEncours').modal('hide');
                              }
                     });
                 });    
       
                 
                 
            
         // DataTable
          var table = $('#idTable').DataTable(
                      {"stateSave": false,
                      "order": [[ 1, "asc" ]],
                       "oLanguage": {
                          "sSearch": "Filtre",
                          "sFirst": "1ere page",
                          "sLast": "Dernière page",
                          "sNext": "Prochaine page",
                          "sPrevious": "Page précédente",
                          "EmptyTable": "Pas de données",
                          "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                          "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                          "sZeroRecords": "Pas d'enregistrement à afficher",
                          "sInfoEmpty": "Pas d'enregistrement à afficher",
                          "sInfoThousands": " ",
                          "sLengthMenu": 'Afficher <select>' +
                                  '<option value="10">10</option>' +
                                  '<option value="20">20</option>' +
                                  '<option value="30">30</option>' +
                                  '<option value="40">40</option>' +
                                  '<option value="50">50</option>' +
                                  '<option value="-1">Tous</option>' +
                                  '</select> enregistrements',
                          "sPaginationType": "full_numbers"
                      }
                     }
                    );
  
    $("#idTable thead td").each( function ( i ) {
    
     if (i != 0 && i != 5 && i != 6){
        var select = $('<select><option value=""></option></select>')
            .appendTo( $(this).empty() )
            .on( 'change', function () {
                table.column( i )
                    .search( $(this).val() )
                    .draw();
            } );
 
        table.column( i ).data().unique().sort().each( function ( d, j ) {
            select.append( '<option value="'+d+'">'+d+'</option>' )
        } );
        };
    } );
    
     
       // DataTable
    var tableMilieu = $('#idTableMilieu').DataTable(
                { "stateSave": false,
                  "order": [[ 1, "asc" ]],
                   "oLanguage": {
                    "sSearch": "Filtre",
                    "sFirst": "1ere page",
                    "sLast": "Dernière page",
                    "sNext": "Prochaine page",
                    "sPrevious": "Page précédente",
                    "EmptyTable": "Pas de données",
                    "sInfo": "Nombre d'enregistrements :  _TOTAL_",
                    "sInfoFiltered": " - filtrés sur _MAX_ enregistrements",
                    "sZeroRecords": "Pas d'enregistrement à afficher",
                    "sInfoEmpty": "Pas d'enregistrement à afficher",
                    "sInfoThousands": " ",
                    "sLengthMenu": 'Afficher <select>' +
                            '<option value="10">10</option>' +
                            '<option value="20">20</option>' +
                            '<option value="30">30</option>' +
                            '<option value="40">40</option>' +
                            '<option value="50">50</option>' +
                            '<option value="-1">Tous</option>' +
                            '</select> enregistrements',
                    "sPaginationType": "full_numbers"
                }
               }
              );
     
  
    $("#idTableMilieu thead td").each( function ( i ) {
    
     if (i != 0  && i != 5 && i != 6 ){
        var select = $('<select><option value=""></option></select>')
            .appendTo( $(this).empty() )
            .on( 'change', function () {
                tableMilieu.column( i )
                    .search( $(this).val() )
                    .draw();
            } );
 
        tableMilieu.column( i ).data().unique().sort().each( function ( d, j ) {
            select.append( '<option value="'+d+'">'+d+'</option>' )
        } );
        };
    } );
    
    
    
    /* Nombre de groupes cocheées*/
   var nbcocher = function() {
   var info = tableMilieu.page.info();
   var nbRecords = $('#idTableMilieu_length option:selected').val();
   tableMilieu.page.len( -1 ).draw();
   var n = $( "input:checked" ).length;
   html = "Groupes cochés  : <span class='badge'>" + n  + "</span>"; 
   $("#idNbCocher p").html(html);
   tableMilieu.page.len(nbRecords).draw();
   tableMilieu.page(info.page).draw(false);
  };
  nbcocher();

$("#modal_groupe_parametres").draggable({
      handle: ".modal-header"
      });
  
  $("#modal_milieu_groupe_parametres").draggable({
      handle: ".modal-header"
  });     
  
  $("#modal_valider").draggable({
      handle: ".modal-header"
  });    
  
   function remplacer(val){
     val =  val.replace("&#039;","'");
     val =  val.replace("&#039;","'");
     val =  val.replace("&#039;","'");
     val =  val.replace("&#039;","'");
      return val;
  }
  
  function remplacer1(val){
     val =  val.replace("&#039;"," ");
     val =  val.replace("&#039;"," ");
     val =  val.replace("&#039;"," ");
     val =  val.replace("&#039;"," ");
      return val;
  }
                 
  
 {% endblock scripts %}
